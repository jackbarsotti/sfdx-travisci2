import * as request from 'request';
import { Readable } from 'stream';
import { URL } from 'url';
import { NpmName } from '../util/NpmName';
export declare const WHITELIST_FILENAME = "unsignedPluginWhiteList.json";
export declare const DEFAULT_REGISTRY = "https://registry.npmjs.org/";
export declare const getNpmRegistry: () => URL;
export declare type IRequest = (url: string, cb?: request.RequestCallback) => Readable;
/**
 * simple data structure representing the discovered meta information needed for signing,
 */
export declare class NpmMeta {
    tarballUrl: string;
    signatureUrl: string;
    publicKeyUrl: string;
    tarballLocalPath: string;
    verified: boolean;
}
export interface ConfigContext {
    configDir?: string;
    cacheDir?: string;
    dataDir?: string;
}
export interface Verifier {
    verify(): Promise<NpmMeta>;
    isWhiteListed(): Promise<boolean>;
}
/**
 * class for verifying a digital signature pack of an npm
 */
export declare class InstallationVerification implements Verifier {
    private pluginNpmName;
    private config;
    private readonly requestImpl;
    private fsImpl;
    private readonly readFileAsync;
    private readonly unlinkAsync;
    private logger;
    constructor(requestImpl?: IRequest, fsImpl?: any);
    /**
     * setter for the cli engine config
     * @param _config cli engine config
     */
    setConfig(_config?: ConfigContext): InstallationVerification;
    /**
     * setter for the plugin name
     * @param _pluginName the published plugin name
     */
    setPluginNpmName(_pluginName?: NpmName | undefined): InstallationVerification;
    /**
     * validates the digital signature.
     */
    verify(): Promise<NpmMeta>;
    isWhiteListed(): Promise<boolean>;
    /**
     * Retrieve url content for a host
     * @param url host url.
     */
    getSigningContent(url: any): Promise<Readable>;
    /**
     * Downloads the tgz file content and stores it in a cache folder
     */
    streamTagGz(): Promise<NpmMeta>;
    private getConfigPath;
    private getCachePath;
    /**
     * Invoke npm to discover a urls for the certificate and digital signature.
     */
    private retrieveNpmMeta;
    private getLogger;
}
export declare class VerificationConfig {
    private _verifier;
    private _log;
    private _prompt;
    verifier: Verifier;
    log: (message: string) => void;
    prompt: (message: string) => Promise<string>;
}
export declare function doPrompt(vconfig: VerificationConfig): Promise<void>;
export declare function doInstallationCodeSigningVerification(config: ConfigContext, { plugin, tag }: {
    plugin: string;
    tag: string;
}, verificationConfig: VerificationConfig): Promise<void>;
